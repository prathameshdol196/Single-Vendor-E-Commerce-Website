<!-- app/templates/admin/dashboard.html -->

{% extends 'base.html' %}
{% block title %}Admin Dashboard - E-commerce Platform{% endblock %}
{% block content %}
<h2 class="mt-4">Admin Dashboard</h2>

<!-- Products Section -->
<h3>Manage Products</h3>
<a href="{{ url_for('admin.add_product') }}" class="btn btn-success mb-3">Add New Product</a>
<table class="table table-bordered">
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Price</th>
        <th>Stock</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    {% for product in products.items %}
    <tr>
        <td>{{ product.id }}</td>
        <td>{{ product.name }}</td>
        <td>₹{{ '%.2f'|format(product.price) }}</td>
        <td>{{ product.stock }}</td>
        <td>
            <a href="{{ url_for('admin.edit_product', product_id=product.id) }}" class="btn btn-warning btn-sm">Edit</a>
            <form action="{{ url_for('admin.delete_product', product_id=product.id) }}" method="POST"
                  style="display:inline;">
                <button type="submit" class="btn btn-danger btn-sm"
                        onclick="return confirm('Are you sure you want to delete this product?');">Delete
                </button>
            </form>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>

<!-- Pagination Links -->
<nav aria-label="Page navigation">
    <ul class="pagination">
        {% if products.has_prev %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('admin.dashboard', page=products.prev_num) }}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <a class="page-link" href="#" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        {% endif %}

        {% for page_num in products.iter_pages(left_edge=2, right_edge=2, left_current=2, right_current=2) %}
        {% if page_num %}
        {% if page_num == products.page %}
        <li class="page-item active"><a class="page-link" href="#">{{ page_num }}</a></li>
        {% else %}
        <li class="page-item"><a class="page-link" href="{{ url_for('admin.dashboard', page=page_num) }}">{{ page_num
            }}</a></li>
        {% endif %}
        {% else %}
        <li class="page-item disabled"><a class="page-link" href="#">…</a></li>
        {% endif %}
        {% endfor %}

        {% if products.has_next %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('admin.dashboard', page=products.next_num) }}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <a class="page-link" href="#" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
        {% endif %}
    </ul>
</nav>

<!-- Orders Section -->
<h3 class="mt-5">Manage Orders</h3>
<table class="table table-striped">
    <thead>
    <tr>
        <th>Order ID</th>
        <th>User</th>
        <th>Total (₹)</th>
        <th>Date Ordered</th>
        <th>Status</th>
        <th>Products</th>
    </tr>
    </thead>
    <tbody>
    {% for order in orders.items %}
    <tr>
        <td>{{ order.id }}</td>
        <td>{{ order.user.username }} ({{ order.user.email }})</td>
        <td>{{ '%.2f'|format(order.total) }}</td>
        <td>{{ order.date_ordered.strftime('%Y-%m-%d %H:%M:%S') }}</td>
        <td>{{ order.status }}</td>
        <td>
            <ul>
                {% for item in order.products %}
                <li>{{ item.product.name }} - Quantity: {{ item.quantity }}</li>
                {% endfor %}
            </ul>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>

<!-- Pagination Links for Orders -->
<nav aria-label="Page navigation">
    <ul class="pagination">
        {% if orders.has_prev %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('admin.dashboard', page=orders.prev_num) }}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <a class="page-link" href="#" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        {% endif %}

        {% for page_num in orders.iter_pages(left_edge=2, right_edge=2, left_current=2, right_current=2) %}
        {% if page_num %}
        {% if page_num == orders.page %}
        <li class="page-item active"><a class="page-link" href="#">{{ page_num }}</a></li>
        {% else %}
        <li class="page-item"><a class="page-link" href="{{ url_for('admin.dashboard', page=page_num) }}">{{ page_num
            }}</a></li>
        {% endif %}
        {% else %}
        <li class="page-item disabled"><a class="page-link" href="#">…</a></li>
        {% endif %}
        {% endfor %}

        {% if orders.has_next %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('admin.dashboard', page=orders.next_num) }}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <a class="page-link" href="#" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endblock %}
